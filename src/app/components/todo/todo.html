<div class="todo-item card card-padding flex-center gap-standard margin-bottom-standard">
  <mat-checkbox
    class="todo-checkbox"
    [id]="item().id.toString()"
    [checked]="item().isChecked"
    (change)="onCheckboxClicked($event)"
  ></mat-checkbox>

  <div
    class="todo-content flex-column gap-sm"
    [formGroup]="form"
  >
    @if (isInEditMode()) {
      <div class="edit-fields flex-column gap-md">
        <input
          matInput
          class="todo-text-input input-seamless text-tight"
          formControlName="content"
          (keydown)="onKeyDown($event)"
          (blur)="saveEdit()"
          placeholder="Task description"
          #editInput
        />
        <input
          matInput
          class="todo-date-input input-seamless text-tight text-small"
          formControlName="endDate"
          (input)="onDateInput($event)"
          (keydown)="onKeyDown($event)"
          (blur)="onDateBlur()"
          placeholder="DD/MM/YYYY"
        />
      </div>
      @if (form.get('endDate')?.errors) {
        <div class="error-message text-small text-error">
          @if (form.get('endDate')?.errors?.['invalidFormat']) {
            Please use DD/MM/YYYY format
          }
          @if (form.get('endDate')?.errors?.['pastDate']) {
            Date must be today or in the future
          }
        </div>
      }
    } @else {
      <div
        class="todo-text hover-bg text-tight"
        (click)="startInlineEditing()"
      >
        {{ item().content }}
      </div>
      <div
        class="todo-date hover-bg text-small text-secondary text-tight"
        [class.overdue]="isOverdue()"
        (click)="startInlineEditing()"
      >
        @if (item().category === 'active') {
          Complete by: {{ item().endDate | date: 'dd/MM/yyyy' }}
          @if (isOverdue()) {
            (Overdue)
          }
        } @else {
          Completed on: {{ item().completedDate | date: 'dd/MM/yyyy' }}
        }
      </div>
    }
  </div>

  <div class="todo-actions flex-center gap-md">
    @if (!isInEditMode()) {
      @if (item().category === 'active') {
        <mat-icon
          class="todo-icon icon-interactive icon-primary"
          fontIcon="edit"
          (click)="openDialog()"
          title="Edit"
        ></mat-icon>
      }
      <mat-icon
        class="todo-icon icon-interactive icon-danger"
        fontIcon="delete"
        (click)="onCheckBoxDeleted()"
        title="Delete"
      ></mat-icon>
    }
  </div>
</div>
